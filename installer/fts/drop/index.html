<html>
    <head>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="//code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">
        <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
        <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
        <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
        <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
        <style>
            ul { list-style-type: none; margin: 0; padding: 0; margin-bottom: 10px; margin-left:100px}
            li { margin: 5px 0px; padding: 5px; width: 150px;user-select: none; }
            .ui-state-highlight{
                background: #fff;
                border:1px dashed #000;
                height: 32px;
            }
        </style>
        <script>
            $(function () {
                var sort = $("#sortable").sortable({
                    revert     : true,
                    containment: "document",
                    placeholder: "ui-state-highlight",
                    start      : function (event, ui) {
                        var ownLeft = parseInt($(ui.item).css('marginLeft'));
                        $('.ui-state-highlight').css('marginLeft', ownLeft);
                    },
                    sort       : function (event, ui) {
                        if ($(ui.item).prev('.ui-sortable-handle').length > 0) {
                            var parentLeft = parseInt($(ui.item).prev('.ui-sortable-handle').css('marginLeft'));
                            var ownLeft = parseInt($(ui.item).css('marginLeft'));
                            var maxLeft = parentLeft + 30;
                            if (ui.position.left - ui.originalPosition.left > 30) {
                                var offset = ownLeft + 30 > maxLeft ? maxLeft : ownLeft + 30;
                                $('.ui-state-highlight').css('margin-left', offset + 'px')
                            } else if (ui.originalPosition.left - ui.position.left > 30) {
                                var offset = ownLeft - 30 < 0 ? 0 : ownLeft - 30;
                                $('.ui-state-highlight').css('margin-left', offset + 'px')
                            }
                        }
                    },
                    beforeStop : function (event, ui) {
                        if ($(ui.item).prev('.ui-sortable-handle').length > 0) {
                            var parentLeft = parseInt($(ui.item).prev('.ui-sortable-handle').css('marginLeft'));
                            var ownLeft = parseInt($(ui.item).css('marginLeft'));
                            var maxLeft = parentLeft + 30;
                            //console.log(ownLeft)
                            if (ui.position.left - ui.originalPosition.left > 30) {
                                var offset = ownLeft + 30 > maxLeft ? maxLeft : ownLeft + 30;
                                //console.log(offset);
                                $(ui.item).css('margin-left', offset + 'px')
                            } else if (ui.originalPosition.left - ui.position.left > 30) {
                                var offset = ownLeft - 30 < 0 ? 0 : ownLeft - 30;
                                $(ui.item).css('margin-left', offset + 'px')
                                //console.log(1)
                            }
                        }
                    }
                });
                $('button.get').on('click', function () {
                    var list = $("#sortable li")
                    list.map(function(k){
                        console.log(list.eq(k).attr('id'))
                    })
                })
                $('button.add').on('click', function () {
                    $('<li class="ui-state-default" id="6">Item 6</li>').appendTo($('#sortable'));
                })
                $('button.remove').on('click', function () {
                    $('#6').remove();
                })
            });
        </script>
    </head>
    <body>
        <ul id="sortable">
            <li class="ui-state-default" id="1">Item 1</li>
            <li class="ui-state-default" id="2">Item 2</li>
            <li class="ui-state-default" id="3">Item 3</li>
            <li class="ui-state-default" id="4">Item 4</li>
            <li class="ui-state-default" id="5">Item 5</li>
        </ul>
        <button class="get">获取结果</button>
        <button class="add">添加item</button>
        <button class="remove">删除item</button>
    </body>
</html>